---

- name: pull the kubeconfig from the master
  fetch: src="{{ item }}" dest=/root/SAVED_AND_SENSITIVE_VOLUME/cluster-info/{{ logical_cluster_name }}
  with_items:
    - /etc/hosts 
    - /etc/kubernetes/kubectl.kubeconfig   
    - /etc/kubernetes/config
    - /etc/kubernetes/apiserver

#
# This relies on the clusters added to /etc/hosts from local-etc-hosts-cluster-include
#
- name: set kubectl command
  set_fact: 
    kubectl: "kubectl --kubeconfig=/root/SAVED_AND_SENSITIVE_VOLUME/cluster-info/{{ logical_cluster_name}}/{{ inventory_hostname }}/etc/kubernetes/kubectl.kubeconfig"

#
# should be blockinfile prolly elsewhere
#
- name: Cluster hosts/IP in local hosts
  connection: local
  local_action: shell cat /root/SAVED_AND_SENSITIVE_VOLUME/cluster-info/{{ logical_cluster_name}}/{{ inventory_hostname }}/etc/hosts >> /etc/hosts