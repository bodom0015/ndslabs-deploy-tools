- name: NDSLabs| copy yaml
  template: src="{{ item }}.j2" dest="/tmp/{{ item }}"
  with_items:
    - default-ingress.yaml
    - ndslabs-apiserver.yaml
    - ndslabs-webui.yaml

- name: ApiServer status
  command: kubectl get rc ndslabs-apiserver
  ignore_errors: yes
  register: apiserver

- name: WebUI status
  command: kubectl get rc ndslabs-gui
  ignore_errors: yes
  register: webui

- name: Ingress status
  command: kubectl get ing ndslabs-ingress
  ignore_errors: yes
  register: ingress

- name: NDSLabs| create default-ingress
  command: kubectl create -f "/tmp/default-ingress.yaml"
  when: ingress.rc != 0

- name: NDSLabs| create ndslabs-apiserver
  command: kubectl create -f "/tmp/ndslabs-apiserver.yaml"
  when: apiserver.rc != 0

- name: NDSLabs| create ndslabs-gui
  command: kubectl create -f "/tmp/ndslabs-webui.yaml"
  when: webui.rc != 0


